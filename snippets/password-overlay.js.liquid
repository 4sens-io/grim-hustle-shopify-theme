(function() {
  var overlay = document.createElement('div');
  overlay.classList.add('overlay-content');
  overlay.innerHTML = `
    <style>
      @font-face {
        font-family: 'Gobold Bold';
        src: url("https://cdn.shopify.com/s/files/1/0830/4102/6392/files/Gobold_Bold.woff2?v=1714484286") format("woff2");
        font-display: swap;
      }
      @font-face {
        font-family: 'Gobold';
        src: url("https://cdn.shopify.com/s/files/1/0830/4102/6392/files/Gobold_Regular.woff2?v=1714484286") format("woff2");
        font-display: swap;
      }
      {% unless settings.password_overlay_title_font_custom != blank %}
      {{ settings.password_overlay_title_font | font_face: font_display: 'swap' }}
      {% endunless %}
      {% unless settings.password_overlay_banner_font_custom != blank %}
      {{ settings.password_overlay_banner_font | font_face: font_display: 'swap' }}
      {% endunless %}
      {% unless settings.password_overlay_body_font_custom != blank %}
      {{ settings.password_overlay_body_font | font_face: font_display: 'swap' }}
      {% endunless %}

      .overlay-content * {
        font-family: {{ settings.password_overlay_body_font_custom | default: settings.password_overlay_body_font.family | default: 'sans-serif' }}, {{ settings.password_overlay_body_font.fallback_families }};
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
      }
      .overlay-content {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: {{ settings.password_overlay_bg_color | default: '#000000' }};
        overscroll-behavior: none;
        touch-action: none;
      }

      .overlay-content {
        display: flex;
        background: {{ settings.password_overlay_bg_color | default: '#000000' }};
      }

      .overlay-content .content {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
        text-align: center;
        padding: 40px 20px 20px;
        gap: 24px;
      }
      .overlay-content .coming-soon {
      color: {{settings.password_overlay_title_font_custom}};
        font-family: {{ settings.password_overlay_title_font_custom | default: settings.password_overlay_title_font.family | default: 'sans-serif' }}, {{ settings.password_overlay_title_font.fallback_families }};
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
        font-style: italic;
        font-size: {{ settings.password_overlay_title_font_size | default: 28 }}px;
        letter-spacing: 2px;
        font-weight: 700;
      }
      .overlay-content .banner-text {
        font-family: {{ settings.password_overlay_banner_font_custom | default: settings.password_overlay_banner_font.family | default: 'sans-serif' }}, {{ settings.password_overlay_banner_font.fallback_families }};
        color: {{ settings.password_overlay_banner_color | default: '#ffffff' }};
        font-size: {{ settings.password_overlay_banner_font_size | default: 14 }}px;
      }
      .overlay-content .form-container {
        width: 100%;
      }
      .overlay-content .password-field {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
        width: 100%
      }
      .overlay-content .password-field input {
        padding: 10px;
        font-size: 16px;
        background: transparent;
        border: 1px solid {{ settings.password_overlay_text_color | default: '#ffffff' }};
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
        width: 100%;
      }
      .overlay-content .password-field input::placeholder {
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
        opacity: 0.7;
      }
      .overlay-content .password-field button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: {{ settings.password_overlay_button_bg_color | default: '#ffffff' }};
        color: {{ settings.password_overlay_button_text_color | default: '#000000' }};
        border: none;
        min-width: fit-content;
      }
      .overlay-content #password-error {
        color: {{ settings.password_overlay_text_color | default: '#ffffff' }};
        margin-top: 10px;
        display: none;
      }
      @media (max-width: 768px) {
        .overlay-content .coming-soon {
          font-size: {{ settings.password_overlay_title_font_size_mb | default: 22 }}px;
        }
        .overlay-content .banner-text {
          font-size: {{ settings.password_overlay_banner_font_size_mb | default: 12 }}px;
        }
        .overlay-content .form-container {
          max-width: 100%;
        }
        .overlay-content .password-field {
          flex-direction: column;
          align-items: stretch;
        }
        .overlay-content .password-field button {
          width: 100%;
        }
      }
    </style>
    <div class="overlay-content" style="height: 100vh; overflow: hidden; position: fixed; left:0; top:0; right:0; bottom:0; justify-content: center; align-items: center; z-index: 999999999999;">
      <div class="content">
        <h1 class="coming-soon">{{ settings.password_overlay_title | default: 'COOMING SOON...' }}</h1>
        <span class="banner-text">{{ settings.password_overlay_banner_text | default: 'A raw story of power, survival, and transformation. The Grim Series merges real experiences with timeless wisdom, guiding you through the darkness of a man\'s becoming.' }}</span>
        <div class="form-container">
          {{settings.password_overlay_iframe_src}}
        </div>
        <div class="password-field">
          <input type="text" id="password-input" placeholder="Enter Password">
          <button type="button" id="password-submit">ENTER NOW</button>
        </div>
        <p id="password-error">Incorrect password. Please try again.</p>
      </div>
    </div>
  `;
  try {
    var bypass = localStorage.getItem('bypass_password');
    if (bypass === 'true') {
      return;
    }
  } catch(e) {}
  (document.body || document.documentElement).appendChild(overlay);
  var embedScript = document.createElement('script');
  embedScript.src = 'https://connect.grimhustle.com/js/form_embed.js';
  embedScript.async = true;
  (document.body || document.documentElement).appendChild(embedScript);
  var submitButton = overlay.querySelector('#password-submit');
  var passwordInput = overlay.querySelector('#password-input');
  var passwordError = overlay.querySelector('#password-error');
  submitButton.addEventListener('click', function(e) {
    e.preventDefault();
    var password = passwordInput.value || '';
    var expected = '{{ settings.password_overlay_password | downcase }}';
    if (expected && password.toLowerCase() === expected) {
      try { localStorage.setItem('bypass_password', 'true'); } catch(e) {}
      try { overlay.remove(); } catch(e) {}
      try {
        var url = new URL(window.location.href);
        url.searchParams.set('ls', 'early-access');
        window.location.href = url.toString();
      } catch(e) {}
    } else {
      passwordError.style.display = 'block';
    }
  });
})();
